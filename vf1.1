.Dd June 25, 2019 
.Dt VF1 1
.Os All Operating Systems
.Sh NAME
.Nm vf1
.Nd command line gopher client
.Sh SYNOPSIS
.Nm
.Op Fl h
.Op Fl \-bookmarks
.Op Fl \-debug
.Op Fl \-tls
.Op Ar url ...
.Sh DESCRIPTION
.Nm
is an interactive command line gopher client.
It presents a prompt to the user, who can then enter commands to perform
actions.
.Pp
Only a small number of commands are needed to get around, and most of
them can be abbreviated to one or two chars, so with practice very quick
navigation of gopherspace is possible.
See the
.Sx COMMANDS
section for more details.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl h , \-help
Display a short help message and exit.
.It Fl \-bookmarks
Immediately navigate to bookmarks upon starting.
.It Fl \-debug
Start with debug mode enabled.
.It Fl \-tls
Start in TLS mode.
In this mode
.Em all
all servers are expected to be TLS enabled.
This is equivalent to using the
.Ic tls
command to switch to TLS mode.
.It Ar url ...
The Gopher URL(s) to open.
If more than one URL is provided, these are queued in a
.Ic tour .
.El
.Pp
.Sh COMMANDS
.Pp
.Ss Concepts
These are some key concepts to understand how
.Nm
works.
.Bl -bullet
.It
.Nm
always has in it's mind exactly one
.Dq index ,
i.e. a list of places in Gopherspace with numbers attached to them.
Typing
.Ic 1
and enter, or
.Ic 2
and enter, etc. will cause
.Nm
to jump to that location in the index.
.It
Whenever a gopher menu is visited, the contents of that menu become the
index, replacing whatever it used to be.
.It
The results of the
.Ic search
or
.Ic history
or
.Ic links ,
commands overwrite the current index.
The index can be reset to the most recently visited gopher menu, with the
.Ic ls
command.
.It
The
.Ic search
command operates on the current index.
This might or might not be the contents of a gopher menu.
For example, the history can be searched. In fact, even the results of an
earlier search can be searched again to narrow things down!
.It
In general,
.Nm
does not remember much.
It always has some idea of the most recently visited gopher menu (i.e. itemtype
1) and the most recently visited gopher document (i.e. any other itemtype).
The
.Ic ls
command always operates on the most recently visited gopher
.Em menu ,
even if non-menu items have been visited since then.
Commands like
.Ic fold ,
.Ic less
and
.Ic save
operate on the most recently visited
.Em non-menu item,
even if menus have been visited since then.
Basically everything operates one the most recently seen thing of the
appropriate type.
.El
.Pp
.Ss Commands
.Bl -tag -width Ds
.It Ic a , add
Add the current URL to the bookmarks menu.
.It Ic b , back
Go back to the last gopher menu.
.It Ic bb , blackbox
Display contents of flight recorder, showing statistics for the current gopher
browsing session.
.It Ic bm , book , bookmarks
Show the current bookmarks menu.
.It Ic f , fold
Process the text of the most recently visited item with the
.Xr fold 1
command.
.It Ic fo , forward
Go forward to the next gopher item.
.It Ic g , go Ar url | mark
Go to a gopher URL or marked item.
.It Ic handler Op Ar mimetype Ar program
List or set handlers for different MIME types.
.It Ic h , hist , history
Display history.
.It Ic l , less
Process the text of the most recently visited item with the
.Xr less 1
command.
.It Ic li , links
Extract URLs from most recently visited item.
.It Ic m , mark Ar mark
Mark the current item with a single letter.
This letter can then be passed to the
.Ic go
command to return to the current item later.
.It Ic n , next
Go to next item after current in index.
.It Ic p , prev, previous
Go to previous item before current in index.
.It Ic q , quit
Exit VF-1.
.It Ic r , reload
Reload the current URL.
.It Ic s , save Op Ar filename
Save an item to the filesystem.
.Ic save Cm n Cm filename
saves index item n to the specified filename.
.Ic save Cm filename
saves the last viewed item to the specified filename.
.Ic save Cm n
saves index item n to an automagic filename.
.It Ic / , se , search Ar pattern
Search index (case insensitive).
.It Ic t , tour Op Ar item ...
Add index items as way points on a tour - a FIFO queue of gopher items.
Items can be added with
.Ic tour Cm "1 2 3 4"
or ranges like
.Ic tour Cm 1-4 .
All items in the index can be added with
.Ic tour Cm * .
The current tour queue can be listed with
.Ic tour Cm ls
and scrubbed with
.Ic tour Cm clear .
.It Ic up , Ic u
Go up one directory in the path.
.It Ic v , veronica
Submit a search query to the Veronica 2 search engine.
.El
.Sh HANDLERS
.Pp
.Nm
uses external programs as
.Dq handlers
to present different gopherspace content to the user.
Even when visiting a plain text file with item type 0,
.Nm
uses (by
default) the unix command
.Xr cat 1
to display that file on the screen, rather than using a Python
.Fn print
call.
Users have full control over which external programs are used for different
content, so the user experience can be customised to taste.
.Pp
Handlers are assigned on the basis of MIME types.
The gopher protocol has no concept of MIME type, so
.Nm
assigns each item a MIME
type as follows:
.Bl -bullet
.It
Item types 0 and 1 are assigned MIME type
.Ql text/plain
.It
Item type h is assigned MIME type
.Ql text/html
.It
Item type g is assigned MIME type
.Ql image/gif
.El
.Pp
For all other item types,
.Nm
attempts to guess a MIME type from the file
extension of the last component of the selector, using the
.Ql mimetypes
module from the Python standard library.
This usually results in a reliable identification assuming the file has an
extension and the author of the gopher content is not being deliberately
deceptive.
.Pp
If the selector has no file extension, or the extension is not
recognised by the
.Ql itemtypes
module,
.Nm
will use the unix program
.Xr file 1
to attempt to guess a MIME type by actually inspecting the content of
the file.
.Pp
In accordance with the idea that gopher item types, which are a
standard part of the protocol, should take precedence over any other
attempt at inferring MIME type, which is not a standard part of the
protocol, if an item in gopherspace is listed with itemtype
.Ql I
or
.Ql s
and one of the above methods returns a MIME type which does not begin
with
.Ql image/
or
.Ql sound/
respectively,
.Nm
will default to
.Ql image/jpeg
or
.Ql audio/mpeg
respectively.
This should only happen in highly unusual circumstances and suggests a poorly
or maliciously configured gopher server.
.Pp
Once a MIME type has been identified for an item, an appropriate handler
program will be used to handle the content.
A list of the current handler assignments can be viewed at any time by running
the
.Ic handler
command.
The default handlers that ship with
.Nm
are:
.Bl -column -offset indent "application/pdf" "lynx -dump -force_html %s"
.It Sy handler          Ta Sy program
.It application/pdf:    Ta xpdf %s
.It audio/mpeg:         Ta mpg123 %s
.It audio/ogg:          Ta ogg123 %s
.It image/*:            Ta feh %s
.It text/*:         Ta cat %s
.It text/html:          Ta lynx -dump -force_html %s
.El
.Pp
The
.Ic handler
command can be used to change these handlers, or set handlers for new MIME
types.
For example, users who prefer
.Xr w3m 1
over
.Xr lynx 1
for handling HTML content could run:
.Pp
.Dl VF-1> handler text/html w3m -dump %s
.Pp
The
.Ql *
wildcard can be used when specifying handler MIME types, e.g.
.Ql image/*
allows using a single program to handle any kind of image.
Handlers without wildcards take precedence over handlers with wildcards.
In other words, if one handler is specified for
.Ql image/jpeg
and a different handler for
.Ql image/* ,
the
.Ql image/jpeg
handler will be used for JPEGs and the
.Ql image/*
handler will be used for all other images.
.Pp
.Sh TEXT ENCODING
.Pp
.Nm
attempts to decode the content received for any text-based item
types (e.g. 0, 1, 7, h) as UTF-8.
Most content in gopherspace is ASCII-encoded, and since UTF-8 is backward
compatible with ASCII, this will generally
.Dq just work .
If the received content
.Em cannot
be decoded as UTF-8, one of two possible things will happen:
.Pp
If the
.Ql chardet
Python module is installed,
.Nm
will use it to attempt to
automatically detect the encoding used and decode the text appropriately.
Note that pip etc. will not install
.Ql chardet
automatically when installing
.Nm ,
as
.Nm
does not formally depend on
.Ql chardet .
It uses it opportunistically, so that it can still be easily installed
and used on systems where
.Ql chardet
is not or cannot be installed.
.Pp
If
.Ql chardet
is not installed, or if
.Ql chardet
cannot identify an encoding with confidence exceeding 0.5,
.Nm
will attempt to
fall back to a single, user-specified alternative encoding.
This encoding can be set as follows:
.Pp
.Dl VF-1> set encoding koi8-r
.Pp
The default fall back encoding is iso-8559-1, which is used by the
popular gopher site
.Lk floodgap.com .
Users who routinely visit gopher sites encoded with some other encoding may
consider using an RC file (see below) to automatically set the alternative
encoding at start up.
.Sh FILES
.\" the longest path name appearing in the list
.Bl -tag -width ~/.vf1-bookmarks.txt -compact
.It Pa ~/.vf1-bookmarks.txt
This file stores gopher bookmarks, in a simple gophermap format (without hosts or ports).
Use
.Ic add
to add the current URL to the bookmark list.
.It Pa ~/.config/vf1/vf1rc
.It Pa ~/.config/.vf1rc
.It Pa ~/.vf1rc
Upon startup,
.Nm
will search for a file with one of these names, a so-called RC file
(see below). The names are listed above in order of preference and
.Nm
will stop after the first one it finds, e.g. if both
.Pa ~/.config/vf1/vf1rc
and a
.Pa ~/.vf1rc
exist then then
.Pa ~/.vf1rc
will be ignored.
.El
.Ss RC FILE
If an RC file is found, each line of the file will be executed as a
.Nm
command before the prompt is displayed. This allows users to script
certain commands that should be run every time
.Nm
is started.  This permits, for example:
.Bl -bullet
.It
Permanently configuring item type handlers by putting
.Ic handler
commands in the RC file.
.It
Permanently configuring the preferred non-UTF-8 encoding, or other
options, by putting
.Ic set
commands in the RC file.
.It
Setting a
.Dq home page
by putting a
.Ic go
command in the RC file.
.It
Starting a tour through a list of favourite sites by putting
.Ic tour
commands in the RC file.
.El
.Sh EXAMPLES
See the
.Xr vf1-turorial 7
for a comprehensive introduction to the work flow of
.Nm
.Pp
Start
.Nm :
.Pp
.Dl vf1
.Pp
Start
.Nm
and immediately open to bookmark list:
.Pp
.Dl vf1 --bookmarks
.Pp
Visit the zaibatsu:
.Pp
.Dl vf1 zaibatsu.circumlunar.space
.Sh SEE ALSO
.Xr vf1-tutorial 7
.Bl -bullet
.It
.Lk https://docs.python.org/3.5/library/mimetypes.html mimetypes
.It
.Lk https://pypi.python.org/pypi/chardet chardet
.El
.Sh STANDARDS
.Nm
is a gopher client conforming to RFC 1436
.Aq Lk https://tools.ietf.org/html/rfc1436 .
.Sh AUTHORS
.An Solderpunk
.Aq Mt solderpunk@sdf.org
.An Alex Schroeder
.Aq Mt alex@gnu.org
.An Joseph Lyman
.Aq Mt tfurrows@sdf.org
.An Adam Mayer
.Aq Lk https://github.com/phooky
.An Paco Esteban
.Aq Mt paco@onna.be
